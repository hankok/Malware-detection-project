import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.List;

public class Reg {
	
	static String getPid(String line)
	{
		int pid_start = line.indexOf('[');
		int pid_end = line.indexOf(']');
		String pid = line.substring(pid_start+1, pid_end);
		return pid;
	}
	
	static String getRegPath(String line)
	{
		int reg_path_start = line.indexOf('"');
		int reg_path_end = line.indexOf('"', reg_path_start+1);
		String reg_path = line.substring(reg_path_start+1, reg_path_end);
		return reg_path;
	}
	
	public static void main(String[] args) {
		List<String> cacheRuns = new ArrayList<String>();
		List<String> cacheInternets = new ArrayList<String>();

		try {
			BufferedReader in = new BufferedReader(new InputStreamReader(
					System.in));
			String line;
			while ((line = in.readLine()) != null) {
				if( (line.contains("Software\\Microsoft\\Windows\\CurrentVersion\\Run") ||
					 line.contains("Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\Setup") ||
					 line.contains("Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx") ||
					 line.contains("Software\\Microsoft\\Windows\\CurrentVersion\\RunServices") ||
					 line.contains("Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce") ||
					 line.contains("Software\\Microsoft\\Windows NT\\CurrentVersion\\Svchost") ||
					 line.contains("System\\CurrentControlSet\\Services")) &&
					 line.contains("WRITE_DAC") )
				{
					// TODO find Process exe full path by pid - getPid(line)
					String pid = getPid(line);
					String procNameString = "todo-get-pname";
					
					cacheRuns.add(line);
					System.out.println(procNameString + ";" + pid + "\treg_run\t" + line);
				}
				
				if(line.contains("Software\\Microsoft\\Windows\\CurrentVersion\\Internet") &&
				   line.contains("WRITE_DAC"))
				{
							
					// TODO find Process exe full path by pid
					String pid = getPid(line);
					String procNameString = "todo-get-pname";
					
					cacheInternets.add(line);
					System.out.println(procNameString + ";" + pid + "\treg_internet\t" + line);
				}
				
				if(line.contains("NtSetValueKey"))
				{
					// TODO find Process exe full path by pid
					String pid = getPid(line);
					String procNameString = "todo-get-pname";
					for(String l : cacheRuns)
					{
						if(l.contains(line.substring(0,11)))
						{
							System.out.println(procNameString + ";" + pid + "\treg_run\t" + line);
						}
					}
					
					for(String l : cacheInternets)
					{
						if(l.contains(line.substring(0,11)))
						{
							System.out.println(procNameString + ";" + pid + "\treg_internet\t" + line);
						}
					}
				}
			}
			// Null was received, so loop was aborted.
		} catch (Exception e) {
			System.out.println(e);
		}
	}

}
